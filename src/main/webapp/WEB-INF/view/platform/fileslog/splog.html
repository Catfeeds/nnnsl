@layout("/common/_curd/_container.html"){
<style>
	.inner{
		display: flex;
		width:100%;
		height: 200px;
		/*border:1px solid red;*/
		justify-content: center;
	}
	.item{
		width:auto;
		height: 200px;

		border:1px solid blue;
		text-align: center;
		line-height: 200px;
	}
	.item span{
		font-size: 25px;
	}
	.img{
		width: 100px;
		height: 200px;
		line-height: 200px;
		text-align: center;

	}
	.img img{
		width: 1000px;
		height: 200px;
	}
	.lct{
		width:100%;
		height: 100%;
		text-align: center;
	}
	.sptable{
		width:100%;
		border: 1px solid grey;
	}
	.review{
		border:1px solid lightgrey;
		margin-left: 30px;
		padding:10px;

	}
	.reviewspan{
		display: block;
		margin-top: 10px;
		border: 1px dotted lightblue;
	}
	.reviewdiv{
		margin-bottom: 20px;
	}
	.flex{
		display: flex;
		width:100%;
		height: 100%;
		text-align: center;
	}
	.temp{
		width: 150px;
		height: 80px;
		border:1px solid #9aff13;
		text-align: center;
		line-height: 80px;
		margin: 10px;
		border-radius: 10%;
	}
	.up{
		width: 100%;
		height: 60px;
		line-height: 60px;
		text-align: center;
	}
	.down{
		width:95%;
		height: 20px;
		line-height: 20px;
		text-align: right;
	}
	.small{
		font-size: 10px;
		border: 1px solid blue;
		border-radius: 5px;
		background-color: #00b7ee;
		color: white;
	}
	.big{
		font-size: 20px;
		color: #00b7ee;
	}

	.mobil-left{
		height: 80px;
		background-color: #00B83F;
		color: white;
		font-size: 20px;
		line-height: 80px;
		text-align: center;
		border-radius:   10px 0 0 10px ;
	}
	.mobil-right{
		height: 80px;
		background-color: #00b7ee;
		color: white;
		font-size: 24px;
		line-height: 80px;
		text-align: center;
		border-radius:  0 10px 10px 0;
	}
	.downs{
		color: white;
		font-size: 24px;
	}
	.mobilstatus{
		margin-top: 10px;
		background-color: orange;
		border-radius: 10px;
		height: 80px;
		line-height: 80px;
		text-align: center;
	}
	.viewstatus{
		color: white;
		font-size: 24px;
		text-align: center;
	}
	.mtitle{
		height: 50px;
		line-height: 50px;
		color: white;
		background-color: #00b7ee;
		font-size: 24px;
		text-align: center;
		margin-top: 10px;
		border-radius: 10px;
	}
	.mobiltext{
		border :1px solid grey;
		border-radius: 5px;
	}
	.mobiltable th{
		font-size: 16px;
	}
	.mobiltable td{
		font-size: 14px;
	}
	.buttonflex{
		display: flex;
		justify-content: space-around;
	}
</style>




	<div class="row">
		<!--手机版-->
		<div class="col-xs-3 visible-xs-block visible-sm-block  mobil-left">
			附件
		</div>
		<div class="col-xs-9 visible-xs-block visible-sm-block  mobil-right">
			@if(has(filetitle)){
			@for(f in filetitle){
			<a  class="downs" onclick="downs('${f!}')">${f!}</a>&nbsp;&nbsp;
			@}
			@}else{
				暂时没有附件。。。
			@}
		</div>
		<div class="col-xs-12 visible-xs-block visible-sm-block  mobilstatus">
			<a  class="viewstatus" onclick="spstatus('${fid}')">查看审批进度</a>&nbsp;&nbsp;
		</div>
		<div class="col-xs-12 visible-xs-block visible-sm-block  mtitle">
			正文补充
		</div>
		<div>
			@if(has(mine)){
			<span class="visible-lg-block visible-md-block" style="color: #0000cc">正文补充：</span>
			<!--手机-->
			<div class="visible-xs-block visible-sm-block mobiltext" style="background-color:lightgrey;" >
				<textarea id="discript" style="background-color:lightgrey;font-size:18px;width: 100%; height: 200px" placeholder="填写正文补充">${discript!}</textarea>
			</div>
			@}else{
			<span class="visible-lg-block visible-md-block" style="color: #0000cc;background-color: lightgrey">正文补充：</span>
			<!--手机-->
			<div class="visible-xs-block visible-sm-block" style="background-color:lightgrey;">
				<span style="font-size: 18px">${discript!}</span>
			</div>
			@}
		</div>





		<!--pc版-->
		<div class="col-xs-12 tb-grid">

			<!-- 按钮 -->
			<div class="visible-lg-block visible-md-block" style="margin-bottom: 10px">
				<span style="color: #0000cc">经&nbsp;办&nbsp;人：</span>
				<span>${uname!}</span>
			</div>
			<div class="visible-lg-block visible-md-block">
				<span style="color: #0000cc">审批进度：</span>
				<a  class="btn btn-white" onclick="spstatus('${fid}')">查看审批进度</a>&nbsp;&nbsp;
			</div >
			<div class="visible-lg-block visible-md-block" style="margin: 10px 0 20px 0">
				@if(has(filetitle)){
					<span style="color: #0000cc">附件下载：</span>
					@for(f in filetitle){
						<a  class="btn btn-white" onclick="downs('${f!}')">${f!}</a>&nbsp;&nbsp;
					@}
				@}
			</div>

			<div style="margin-bottom: 20px">

				@if(has(mine)){
				<span class="visible-lg-block visible-md-block" style="color: #0000cc">正文补充：</span>
				<!--电脑-->
				<div class="visible-lg-block visible-md-block reviewdiv">
					<textarea id="discript" style="width: 100%; height: 100px" placeholder="填写正文补充">${discript!}</textarea>
				</div>
				@}else{
				<span class="visible-lg-block visible-md-block" style="color: #0000cc;background-color: grey">正文补充：</span>
				<!--电脑-->
				<div class="visible-lg-block visible-md-block">
					<span>${discript!}</span>
				</div>
				@}
			</div>
			<!--手机-->
			<div class="visible-xs-block visible-sm-block row reviewdiv">
				<textarea id="opinion" style="font-size:18px;width: 100%; height: 100px" placeholder="填写审阅意见"></textarea>
				<div class="buttonflex">
					<button style="float: left" class="btn btn-lg btn-success" id="sugg">提交审阅意见</button>
					<button style="float: right" class="btn btn-lg btn-danger" id="chooseuser">选择同事协同</button>
				</div>

			</div>
			<!--回复发起人-->
			<!--电脑-->
			<div class="visible-lg-block visible-md-block reviewdiv">
				<textarea id="opinion" style="width: 100%; height: 100px" placeholder="填写审阅意见"></textarea>
				<button class="btn btn-success" id="sugg">提交审阅意见</button>&nbsp;<button class="btn btn-danger" id="chooseuser">选择同事协同</button>
			</div>


			<!--手机端-->
			<div class="visible-xs-block visible-sm-block row ">
				<table class="table table-striped mobiltable">
					<thead>
					<tr>
						<th>
							审批人
						</th>
						<th>
							操作时间
						</th>
						<th>
							审阅意见
						</th>
						<th>

						</th>
					</tr>

					</thead>
					<tbody>
					@if(size == 0){
						<tr>
							<td colspan="4" style="text-align: center"> 暂无人操作</td>
						</tr>
					@}
					@for(sp in sps){
					<tr>
						<td>
							<span style="color: #0000cc;">${sp.uname!}</span>
						</td>
						<td>
							${sp.date!,dateFormat="MM-dd"}
						</td>
						<td>
							${sp.opinion!}
						</td>
						<td>
							@if(sp.me == 1){
							<a class="btn btn-success" onclick="review(${sp.id})">回复</a>
							@}
						</td>
					</tr>
						@if(!isEmpty(sp.review)){
							<tr>
								<td colspan="4">
									<div class="review">
										<span>回复意见</span>&nbsp;&nbsp;&nbsp;
										<span>${sp.funame!}</span>&nbsp;&nbsp;&nbsp;<span>${sp.fudate!,dateFormat="MM-dd"}</span><br/>
										<span class="reviewspan">${sp.review}</span>

									</div>
								</td>
							</tr>
						@}
					@}


					</tbody>
				</table>
			</div>


			<!--电脑端-->
			<div class="visible-lg-block visible-md-block sptable">
				<table class="table table-striped">
					<thead>
					<tr>
						<th>
							审批人
						</th>
						<th>
							操作时间
						</th>
						<th>
							审阅意见
						</th>
						<th>

						</th>
					</tr>

					</thead>
					<tbody>
					@if(size == 0){
					<tr>
						<td colspan="4" style="text-align: center"> 暂无人操作</td>
					</tr>
					@}
					@for(sp in sps){
					<tr>
						<td>
							<span style="color: #0000cc;">${sp.uname!}</span>
						</td>
						<td>
							${sp.date!}
						</td>
						<td>
							${sp.opinion!}
						</td>
						<td>
							@if(sp.me == 1){
							<a class="btn btn-success" onclick="review(${sp.id})">回复</a>
							@}
						</td>
					</tr>
					@if(!isEmpty(sp.review)){
					<tr>
						<td colspan="4">
							<div class="review">
								<span>回复意见</span>&nbsp;&nbsp;&nbsp;
								<span>${sp.funame!}</span>&nbsp;&nbsp;&nbsp;<span>${sp.fudate!}</span><br/>
								<span class="reviewspan">${sp.review}</span>

							</div>
						</td>
					</tr>
					@}
					@}


					</tbody>
				</table>
			</div>



			<!-- grid -->
			<!--<table id="grid-table"></table>-->
			<!-- 分页-->
			<!--<div id="grid-pager"></div>-->
		</div>
	</div>
	<input type="hidden" id="userid">
	<!-- 引入所需的js -->
	@include("/common/_listscript.html"){}

	<script>
		$(function(){
			var userid = ""
			var ajaxURL = "/user/getuser";
			$.post(ajaxURL,null,function (res) {
				userid = res.uid
				$('#userid').val(userid)
			});

			$('#chooseuser').on("click",function () {
				var index = layer.open({
					type: 2,
					title:'查看详情',
					area: ['100%', '100%'],
					maxmin:true,
					shadeClose: true, //点击遮罩关闭
					content:  '/user/userchoose?who=jiaqian&&fid=${fid}',
					end:function () {
						window.location.reload()
                    }
				});

				this.layerIndex = index;
			})

			$('#sugg').on("click",function () {
				if($('#opinion').val()===""){
					layer.msg("您还未填写意见，不能提交")
					return false;
				}
				var ajaxURL = "/fileslog/save";
				var ajaxData = {
					"nsl_files_log.f_id":"${fid}",
					"nsl_files_log.ispass":2,
					"nsl_files_log.date":new Date().format("yyyy-MM-dd hh:mm:ss"),
					"nsl_files_log.u_id":$('#userid').val(),
					"nsl_files_log.opinion":$('#opinion').val()
				}
				console.log(ajaxData)
				$.post(ajaxURL,ajaxData,function (res) {
					window.location.reload()
				});
			})

			$("#discript").blur(function(){
				if($('#discript').val()===""){
					return false;
				}
				var ajaxURL = "/files/update";
				var ajaxData = {
					"nsl_files.id":"${fid}",
					"nsl_files.discript":$('#discript').val()
				}
				console.log(ajaxData)
				$.post(ajaxURL,ajaxData,function (res) {
//					window.location.reload()
					layer.msg("提交成功")
				});

			});



		});



		downs = function (entId) {
			window.location.href = "/files/downs?file="+entId;
		};

		spstatus = function (fid) {
			var index = layer.open({
				type: 2,
				title: '审批状态',
				area: ['50%', '50%'],
				maxmin: true,
				shadeClose: true, //点击遮罩关闭
				content: '/blog?fid='+ fid
			});
		}

		review = function (fid) {
			var index = layer.open({
				type: 2,
				title: '回复意见',
				area: ['50%', '50%'],
				maxmin: true,
				shadeClose: true, //点击遮罩关闭
				content: '/files/review?splogid='+ fid,
				end:function () {
					window.location.reload()
				}
			});
		}


	</script>

@}	